{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Generic Application Chart Values",
  "type": "object",
  "properties": {
    "nameOverride": {
      "type": "string",
      "description": "Override the chart name"
    },
    "fullnameOverride": {
      "type": "string",
      "description": "Override the full name of resources"
    },
    "ciRef": {
      "type": "string",
      "description": "CI reference identifier"
    },
    "serviceAccount": {
      "type": "object",
      "properties": {
        "create": {
          "type": "boolean",
          "description": "Whether to create a service account"
        },
        "annotations": {
          "type": "object",
          "description": "Annotations to add to the service account",
          "additionalProperties": {
            "type": "string"
          }
        },
        "name": {
          "type": "string",
          "description": "The name of the service account to use"
        }
      }
    },
    "service": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["ClusterIP", "NodePort", "LoadBalancer", "ExternalName"],
          "description": "Kubernetes Service type"
        },
        "annotations": {
          "type": "object",
          "description": "Annotations to add to the service",
          "additionalProperties": {
            "type": "string"
          }
        }
      }
    },
    "deployment": {
      "type": "object",
      "properties": {
        "replicaCount": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of replicas for the deployment"
        },
        "revisionHistoryLimit": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of old ReplicaSets to retain"
        },
        "annotations": {
          "type": "object",
          "description": "Annotations to add to the deployment",
          "additionalProperties": {
            "type": "string"
          }
        }
      }
    },
    "pod": {
      "type": "object",
      "properties": {
        "annotations": {
          "type": "object",
          "description": "Annotations to add to the pod",
          "additionalProperties": {
            "type": "string"
          }
        },
        "securityContext": {
          "type": "object",
          "description": "Security context for the pod"
        },
        "nodeSelector": {
          "type": "object",
          "description": "Node selector for pod assignment",
          "additionalProperties": {
            "type": "string"
          }
        },
        "tolerations": {
          "type": "array",
          "description": "Tolerations for pod assignment",
          "items": {
            "type": "object"
          }
        },
        "affinity": {
          "type": "object",
          "description": "Affinity rules for pod assignment"
        },
        "imagePullSecrets": {
          "type": "array",
          "description": "Image pull secrets for private registries",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              }
            },
            "required": ["name"]
          }
        },
        "volumes": {
          "type": "array",
          "description": "Volumes to mount in the pod",
          "items": {
            "type": "object",
            "required": ["name"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Name of the volume"
              },
              "type": {
                "type": "string",
                "enum": ["pvc", "configMap", "secret", "image", "emptyDir"],
                "description": "Type of volume (defaults to 'pvc' if not specified)"
              },
              "accessModes": {
                "type": "array",
                "description": "Access modes for PVC volumes",
                "items": {
                  "type": "string",
                  "enum": ["ReadWriteOnce", "ReadOnlyMany", "ReadWriteMany"]
                }
              },
              "storageClassName": {
                "type": "string",
                "description": "Storage class name for PVC volumes"
              },
              "size": {
                "type": "string",
                "description": "Size of the PVC volume (e.g., '1Gi', '10Gi')",
                "pattern": "^[0-9]+(\\.[0-9]+)?(Ki|Mi|Gi|Ti|Pi|Ei|k|M|G|T|P|E)$"
              },
              "configMapName": {
                "type": "string",
                "description": "Name of the ConfigMap (for type: configMap)"
              },
              "secretName": {
                "type": "string",
                "description": "Name of the Secret (for type: secret)"
              },
              "reference": {
                "type": "string",
                "description": "Image reference for Image Volume (for type: image)",
                "pattern": "^[a-z0-9]+(\\.[a-z0-9]+)*(:[0-9]+)?/[a-z0-9-_/]+(:[a-zA-Z0-9_.-]+)?$"
              },
              "pullPolicy": {
                "type": "string",
                "enum": ["Always", "IfNotPresent", "Never"],
                "description": "Pull policy for Image Volume (for type: image)"
              },
              "items": {
                "type": "array",
                "description": "Items to project from ConfigMap or Secret",
                "items": {
                  "type": "object",
                  "properties": {
                    "key": {
                      "type": "string"
                    },
                    "path": {
                      "type": "string"
                    }
                  },
                  "required": ["key", "path"]
                }
              }
            },
            "allOf": [
              {
                "if": {
                  "properties": {
                    "type": {
                      "const": "pvc"
                    }
                  }
                },
                "then": {
                  "required": ["accessModes", "size"]
                }
              },
              {
                "if": {
                  "properties": {
                    "type": {
                      "const": "configMap"
                    }
                  }
                },
                "then": {
                  "required": ["configMapName"]
                }
              },
              {
                "if": {
                  "properties": {
                    "type": {
                      "const": "secret"
                    }
                  }
                },
                "then": {
                  "required": ["secretName"]
                }
              },
              {
                "if": {
                  "properties": {
                    "type": {
                      "const": "image"
                    }
                  }
                },
                "then": {
                  "required": ["reference"]
                }
              }
            ]
          }
        }
      }
    },
    "initContainers": {
      "type": "array",
      "description": "Init containers to run before the main containers",
      "items": {
        "$ref": "#/$defs/container"
      }
    },
    "containers": {
      "type": "array",
      "description": "Application containers",
      "items": {
        "$ref": "#/$defs/container"
      },
      "minItems": 1
    },
    "serviceMonitor": {
      "type": "object",
      "description": "Prometheus ServiceMonitor configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Whether to create a ServiceMonitor"
        },
        "portName": {
          "type": "string",
          "description": "Name of the port to scrape"
        },
        "path": {
          "type": "string",
          "description": "Path to scrape metrics from"
        },
        "labels": {
          "type": "object",
          "description": "Labels to add to the ServiceMonitor",
          "additionalProperties": {
            "type": "string"
          }
        },
        "interval": {
          "type": "string",
          "description": "Scrape interval",
          "pattern": "^[0-9]+(s|m|h)$"
        },
        "scheme": {
          "type": "string",
          "enum": ["http", "https"],
          "description": "Scheme to use for scraping"
        },
        "scrapeTimeout": {
          "type": "string",
          "description": "Scrape timeout",
          "pattern": "^[0-9]+(s|m|h)$"
        },
        "relabelings": {
          "type": "array",
          "description": "Metric relabeling configuration"
        }
      }
    }
  },
  "$defs": {
    "container": {
      "type": "object",
      "required": ["name", "image"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of the container"
        },
        "image": {
          "type": "object",
          "required": ["repository"],
          "properties": {
            "repository": {
              "type": "string",
              "description": "Container image repository"
            },
            "tag": {
              "type": "string",
              "description": "Container image tag"
            },
            "pullPolicy": {
              "type": "string",
              "enum": ["Always", "IfNotPresent", "Never"],
              "description": "Image pull policy"
            }
          }
        },
        "ports": {
          "type": "array",
          "description": "Container ports",
          "items": {
            "type": "object",
            "required": ["name", "port"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Name of the port"
              },
              "protocol": {
                "type": "string",
                "enum": ["TCP", "UDP", "SCTP"],
                "description": "Protocol for the port"
              },
              "port": {
                "type": "integer",
                "minimum": 1,
                "maximum": 65535,
                "description": "Port number"
              },
              "exposed": {
                "type": "boolean",
                "description": "Whether to expose this port in the Service"
              },
              "exposedName": {
                "type": "string",
                "description": "Name to use when exposing in Service (defaults to name)"
              },
              "exposedPort": {
                "type": "integer",
                "minimum": 1,
                "maximum": 65535,
                "description": "Port to use when exposing in Service (defaults to port)"
              }
            }
          }
        },
        "livenessProbe": {
          "type": ["object", "null"],
          "description": "Liveness probe configuration"
        },
        "readinessProbe": {
          "type": ["object", "null"],
          "description": "Readiness probe configuration"
        },
        "securityContext": {
          "type": "object",
          "description": "Security context for the container"
        },
        "resources": {
          "type": "object",
          "description": "Resource requests and limits",
          "properties": {
            "limits": {
              "type": "object",
              "properties": {
                "cpu": {
                  "type": "string",
                  "description": "CPU limit (e.g., '100m', '1')",
                  "pattern": "^[0-9]+(\\.[0-9]+)?(m)?$"
                },
                "memory": {
                  "type": "string",
                  "description": "Memory limit (e.g., '128Mi', '1Gi')",
                  "pattern": "^[0-9]+(\\.[0-9]+)?(Ki|Mi|Gi|Ti|Pi|Ei|k|M|G|T|P|E)$"
                }
              }
            },
            "requests": {
              "type": "object",
              "properties": {
                "cpu": {
                  "type": "string",
                  "description": "CPU request (e.g., '100m', '1')",
                  "pattern": "^[0-9]+(\\.[0-9]+)?(m)?$"
                },
                "memory": {
                  "type": "string",
                  "description": "Memory request (e.g., '128Mi', '1Gi')",
                  "pattern": "^[0-9]+(\\.[0-9]+)?(Ki|Mi|Gi|Ti|Pi|Ei|k|M|G|T|P|E)$"
                }
              }
            }
          }
        },
        "command": {
          "type": ["array", "null"],
          "description": "Container command override",
          "items": {
            "type": "string"
          }
        },
        "args": {
          "type": ["array", "null"],
          "description": "Container args override",
          "items": {
            "type": "string"
          }
        },
        "envFromSecretNames": {
          "type": "array",
          "description": "Load all keys from these Secrets as environment variables",
          "items": {
            "type": "string"
          }
        },
        "env": {
          "type": "array",
          "description": "Environment variables",
          "items": {
            "type": "object",
            "required": ["name", "value"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Environment variable name"
              },
              "value": {
                "type": "string",
                "description": "Environment variable value"
              }
            }
          }
        },
        "volumeMounts": {
          "type": "array",
          "description": "Volume mounts for the container",
          "items": {
            "type": "object",
            "required": ["name", "mountPath"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Name of the volume to mount (must match pod.volumes[].name)"
              },
              "mountPath": {
                "type": "string",
                "description": "Path to mount the volume at",
                "pattern": "^/"
              },
              "subPath": {
                "type": "string",
                "description": "Sub-path within the volume to mount"
              },
              "readOnly": {
                "type": "boolean",
                "description": "Whether to mount as read-only"
              }
            }
          }
        },
        "files": {
          "type": "array",
          "description": "Files to create in the container via ConfigMap",
          "items": {
            "type": "object",
            "required": ["path", "content"],
            "properties": {
              "path": {
                "type": "string",
                "description": "Path where the file should be created",
                "pattern": "^/"
              },
              "content": {
                "type": "string",
                "description": "Content of the file"
              }
            }
          }
        }
      }
    }
  }
}
